#!/bin/bash
#  Recursively find all directories with git repos, and try to pull them.


if [ "-h" = "$1" -o "--help" = "$1" ]; then
    cat <<EOF
$0 [options]
   Recursively find all directories with git repos, and try to pull them.
   All flags except -h and --help are passed to git pull.
   If anything fails, a reasonable next step would be pull --rebase.
   options:
      -h or --help - print this message and exit
      -t time      - wait time seconds between pulls (default 4)
EOF
    exit
elif [ "-t" = "$1" ]; then
    shift
    time=$1
    shift
else
    time=4
fi

flags="${*:---ff-only}"
repos=`find . -name .git -print | sort`
for f in $repos; do 
    (cd `dirname $f`; echo -n `pwd` " "; git pull $flags)
    sleep $time # for some reason dreamhost gets bent out of shape if you make
                # more than 11 ssh connections in a row, so throttle back.
done
