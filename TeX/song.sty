%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% SONG.STY %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%
%%% Author: Stephen Savitzky
%%%	    $Id: song.sty,v 1.11 2010-10-14 06:48:15 steve Exp $
%%%
%%% Song environment:
%%%	\begin{song}{title}			% starts on a new page
%%%
%%%	  \subtitle{subtitle, set in smaller type}
%%%	  \notice{centered copyright notice}
%%%             \CcByNcSa			% Creative Commons license
%%%	  \dedication{centered dedication}
%%%	  \description{description}		% defines \theDescription
%%%		(The description is used only for liner notes, etc.; it
%%%		 does not appear in typeset lyrics)
%%%	  \tags{tag1,tag2...}			% defines \theTags
%%%       \category{tag1,tag2...}		% obsolete version of tags
%%%	  \key{C\; (A \capo 3)}			% defines \theKey
%%%	  \timing{mm:ss}			% defines \theTiming
%%%	  \created{yymmdd}			% defines \theCrDate
%%%	  \cvsid{$Id ...}			% defines \theCVSid
%%%	  \lyrics{lyricist}			% specifies theLyricist
%%%	  \music{composer}			% specifies theComposer
%%%	  \arranger{arranger}			% specifies theArranger
%%%	  \credits{credits}			% specifies theCredits
%%%       \performance{performance notes}       % specifies perf. notes
%%%
%%%	  \begin{note}
%%%		left-justified, paragraphed text set in smaller type
%%%	  \end{note}
%%%
%%%	  lines of song separated by newline
%%%	  \; indented single line with no extra space around it.
%%%	  chords like th[A]is
%%%	  \verse or \\
%%%	  between verses
%%%	  \spoken{spoken parts in slanted type}
%%%	  \begin{refrain}
%%%	    indented refrain with verse spacing
%%%	  \end{refrain}
%%%	  \begin{bridge}
%%%	      indented (2em) bridge with verse spacing
%%%	  \end{bridge}
%%%	  \inset{1-line instructions in italics, indented 1em}
%%%	\end{song}
%%%	\tailnote{Note text at the bottom of the page}
%%%	\link{url}{anchor text}
%%%
%%%	  \vfiller{n}		insert n lines of filler to balance
%%%				columns in twocolumns environment
%%%
%%%	[chord]			set in a 0-width raised box
%%%	\chord{set as chord but not raised}
%%%	  Chords are set in math mode (to get superscripts and special chars.)
%%%	  The following chord elements are defined:
%%%	    \flat 	modified b
%%%	    \sharp	modified #
%%%	    \dim 	subscript circle
%%%	    \aug	superscript plus
%%%	    \maj	{\rm maj}
%%%	    \sus4	{\rm sus}4	(also 2) 
%%%		sometimes changed to superscript to save horizontal space
%%%	    \min	prints as m
%%%	    \add	prints as &
%%%	    \up		prints as double uparrow, e.g. F(D\up3)
%%%		used to indicate barre chords and the like.
%%%	    *		indicates chords with B or E string raised
%%%	    \capo	{\it capo} used in, e.g.  \key{F\; (D\capo3)}
%%%	    \;		em space
%%%
%%%
%%%  \file{songfile}	input a song file; set \theFile to the filename
%%%
%%%  Page styles: 
%%%	  broadside	songs on un-numbered single sheets
%%%	  songbook	numbered pages set up for two-sided printing
%%%	  boxed		plain boxed headers/footers: use markXY and tagXY
%%%	  ruled		plain ruled headers/footers: use markXY and tagXY
%%%	  shadowed	plain shadow-boxed headers/footers
%%%
%%%	  \tallpage	adds an extra inch to the text height
%%%	  \widepage	adds an extra inch to the text width
%%%
%%%  Page formatting elements:
%%%		additional conditional code can be put in the marks
%%%		and tags to swap them on odd and even pages.
%%%
%%%	\markUL{x}	mark upper left		defines \ULmark
%%%	\markUC{x}	mark upper center	etc.
%%%	\markUR{x}	mark upper right
%%%	\markLL{x}	mark lower left
%%%	\markLC{x}	mark lower center
%%%	\markLR{x}	mark lower right
%%%
%%%	\tagXY{x}	tag {upper,lower}{left, center,right}
%%%			  the tags are like the marks except that in the
%%%			  boxed styles they come underneath the boxes.
%%%
%%%		The following rules can be redefined for shadow effects.
%%%	\HFTrule	header/footer top box rule
%%%	\HFBrule	header/footer bottom box rule
%%%	\HFLrule	header/footer left rule
%%%	\HFRrule	header/footer right rule
%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%
%%% Informational Components (notice, etc.)
%%%
\def\Centered #1{\begin{center}#1\end{center}}
\let\notice=\Centered
\def\SomeRightsReserved{Some Rights Reserved\footnote{\CcByNcSa}}
\def\CcByNcSa{This work is licensed under a Creative Commons
Attribution-Noncommercial-Share Alike 4.0 License.}  
\def\subtitle #1{\begin{center}\bf #1\end{center}}
\def\license #1{\begin{center}\small #1\end{center}}
\let\dedication=\Centered
\def\ttto #1{{\sc ttto:} {\em #1\/}}

\def\link#1#2{#2\footnote{$<$#1$>$}}

%%% define global variables for all the header statements
%%% Note that some aren't used by LaTeX; they're for other formats, too.

\def\timing#1{\global\def\theTiming{#1}}\def\theTiming{}
\def\category#1{\global\def\theTags{#1}}\def\theTags{}
\def\tags#1{\global\def\theTags{#1}}\def\theTags{}
\def\description#1{\global\def\theDescription{#1}}\def\theDescription{}
\def\key#1{\global\def\theKey{#1}}\def\theKey{}
\def\created#1{\global\def\theCrDate{#1}}\def\theCrDate{}
\def\cvsid#1{\global\def\theCVSid{#1}}\def\theCVSid{}
\def\lyrics#1{\global\def\theLyricist{#1}}\def\theLyricist{}
\def\music#1{\global\def\theComposer{#1}}\def\theComposer{}
\def\arranger#1{\global\def\theArranger{#1}}\def\theArranger{}
\def\credits#1{\global\def\theCredits{#1}}\def\theCredits{}
\def\performance#1{\global\def\thePerformance{#1}}\def\thePerformance{}

\global\def\theSong{}

%%%
%%% note, headnote, tailnote
%%%
\def\note{\quotation\footnotesize %
	\catcode`\^^M=5 % ascii return is end-line
}
\let\endnote=\endquotation
\long\def\headnote#1{\begin{note}#1\end{note}}
\long\def\tailnote#1{\vfill\begin{note}#1\end{note}}

%%%
%%% The song and refrain environments
%%%
\newenvironment{song}[1]{\newpage
  % we don't need to put out the title; it's in the page header
  % tags, creation date, file, etc. want to be put out at the beginning of the lyrics.
 \global\def\theSong{#1}
 \global\def\theTags{}\global\def\theTiming{}
 \global\def\theCrDate{}\global\def\theKey{}
 \begingroup
 \parskip 0pt plus 1pt
 \parindent 0pt
 \let\\=\verse
 \obeylines\catcode`\[=13}{
 \addcontentsline{toc}{Song}{\hbox{{\tt \hbox to 7em{\theFile\hss}}\hbox to 2em{\hss\theTiming}\;\hbox{\theSong\hss}}}
 \endgroup}

\newenvironment{refrain}{\list{}{\listparindent 1em
 \itemindent\listparindent
 \labelwidth 0pt
 \rightmargin 0pt
 \parsep 0pt plus 1pt}\item[]}{\endlist}

\newenvironment{bridge}{\list{}{\listparindent 2em
 \itemindent\listparindent
 \labelwidth 0pt
 \rightmargin 0pt
 \parsep 0pt plus 1pt}\item[]}{\endlist}

\def\indent{\list{}{\listparindent 6em
 \itemindent\listparindent
 \labelwidth 0pt
 \rightmargin 0pt
 \obeylines%
 \parsep 0pt plus 1pt}\item[]}
\let\endindent=\endlist

\def\Indent{\list{}{\listparindent 8em
 \itemindent\listparindent
 \labelwidth 0pt
 \rightmargin 0pt
 \obeylines%
 \parsep 0pt plus 1pt}\item[]}
\let\endIndent=\endlist

{\obeylines% We have to do this inside \obeylines to make it work right.
\global\def\Indented#1{\begin{refrain}
 #1
\end{refrain}}}


\def\inset#1{{\hskip1em\it #1}}
\def\inst#1{{\it #1}}
\def\singer#1{{\hskip-.5em\tt #1}} %\hskip-1em seems excessive
\def\spoken#1{{\sl #1}}
\def\verse{\par\medskip\par}

\def\;{\hskip 1em}  % used for indentation, esp; to continue a line.
                    % many uses can be replaced by begin{refrain}


\def\vfiller#1{\vbox to #1\baselineskip{}}

%%%
%%% Replace the old twocolumns environment with multicol
%%%
\usepackage{multicol}

\newenvironment{twocolumns}{
  \begin{multicols}{2}}{\end{multicols}}

%%%
%%% Table of contents is supposed to look like a song
%%%
\def\l@Song#1#2{#1\par}
\def\tableofcontents{\begin{song}{LIST OF SONGS}
 \@starttoc{toc}\end{song}}

%%%
%%% \file{filename} Input a file containing a song. 
%%%	We force a pagebreak here to ensure that the previous song
%%%	doesn't pick up the new filename in its header and footer.
%%%     Songs now consist only of a song environment, so we don't have to
%%%	turn off \documentstyle and \begin{document}...\end{document}.
%%%
\def\file#1{\newpage\begingroup
\def\theFile{#1}
\def\documentstyle[##1]##2{}
\input{#1}
\endgroup}
%
% \theFile defaults to \jobname, so that it doesn't have to be provided in
% the common case where we're just formatting a single song.
%
\def\theFile{\jobname}

%%%
%%% \ignore{stuff}	Ignore some stuff.
%%%	A crude form of extended, nestable comment
%%%	frequently useful for cancelling out lists of songs.
%%%

\long\def\ignore#1{}

%%%
%%% Chords.
%%%	Note that chords are set in math mode
%%%
\def\chordfont{\sf}
\def\chord #1{{\footnotesize\strut$\chordfont #1$}}
\def\@chord #1{\makebox[0pt][l]{\raisebox{.9em}{\chord{#1}}}}

\def\dim{_\circ}
\def\aug{^+}
\def\maj{\mbox{maj}}
\def\min{\mbox{m}}
\def\sus{\mbox{sus}}
\def\capo{\mbox{\ \it capo\ }}
\def\drop{\mbox{\ \it drop\ }}
\def\up{\Uparrow}
\def\add{\&}
%\def\sharp{\#}
%\def\flat{b}

\catcode`\[=13
\def[#1]{\@chord{#1}}
\catcode`\[=12


